% 14 May 2019, @Amer Tahat @Pronnoy Gawsami @Sarang Joshi    
 
# Renee

## Radare2PVS translation 
Convert the terminal functions from Zircon/Linux or another target binary into the output PVS files using a shell script. .

## Project setup Instructions

1. Clone the repository

         https://github.com/AmerNTahat/Renee.git

2. Radare2 installation
Renee Toolchain works for the radare2 version 3.1.3. We encountered bugs after installing the latest version (3.3.0) on new machines. Hence, it is a must to install the correct version from the archives.

Radare2 l documentation link https://www.radare.org/r/down.html

1. First download the tarball for the correct version using 
        ~ $ wget https://github.com/radare/radare2/archive/3.1.3.tar.gz
        ~ $ tar xzvf 3.1.3.tar.gz
        ~ $ cd radare2-3.1.3/
        ~/radare2-3.1.3 $ ./configure --prefix=/usr
        ~/radare2-3.1.3 $ make -j8
        ~/radare2-3.1.3 $ sudo make install

OR

2. Install from Git:
        git clone https://github.com/radare/radare2
        cd radare2
        sys/install.sh   # just run this script to update r2 from git

3. Change the directory to Renee/ReneeISAGenerator/ASL2PVS_code/Decoder_radare2_to_PVS/

4. Run the following shell script to generate the output pvs files from the binary.

        ./generate_pvs_files.sh

   Enter the filename: all_verified_fnc_per_inst_zircon (for Zircon) and all_verified_fnc_per_inst_linux (for Linux)

   The output will be generated in the folder
	
	output_pvs_files

5. Run the following shell script to remove all the output folders and generate the pvs files for a new target.
	
	./clean_outputs.sh

6. Uninstall:

To uninstall a r2 from a specific prefix run the following commands on the root directory of the radare2 source code:
        ~ $ cd radare2
        ~/radare2 $ ./configure --prefix=/usr
        ~/radare2 $ sudo make uninstall

In case you want to remove all previous installations purge it.
~/radare2 $ sudo make purge

## Running the Radare2PVS toolchain: 
Radare2PVS shell script is a wrapper around 4 main scripts that are used for generating the output pvs files.It starts with the binary file for ARMv8.There are multiple steps in this process and files for each step need to be in a specific format. Each of these files are inputs to scripts.Below is a description of all the file formats at each stage of the Renne toolchain from binary input file to the corresponding pvs files.


1> Input .r2 radare file with function names [manually created]  ( clock_get_syscalls.r2 )
   dir = {Decoder_radare2_to_PVS}/assets/input_r2_files

2> terminal_fn_finder_recursive.py ( assets/clock_get_class_syscalls.r2 ) ====> ( clock_get_class_syscalls.fn_term* , clock_get_class_syscalls.term**  )
   Input_dir = {Decoder_radare2_to_PVS}/assets/radare2_r2_input_files
   Output_dir = {Decoder_radare2_to_PVS}/assets/intermediate_term_files

   ** This is an intermediate input/output file gives an overall aggregation of terminal functions , * This is an analysis file which gives terminql functions for 	every syscall in the input file

3> json_generator.py ( clock_get_class_syscalls.term ) ======> *.json files, clock_get_syscalls.batch
   Input_dir = {Decoder_radare2_to_PVS}/intermediate_term_files/clock_get_class_syscalls.term
   Output_dir = {Decoder_radare2_to_PVS}/intermediate_json_files/*.json files

4> json_parser_radare2.py ( clock_get_syscalls.batch ) =======> ( *.dec files, *_main.pvs files, clock_get_syscalls.dec_batch,  loop_analysis_info.txt ) *
   Input_dir = {Decoder_radare2_to_PVS}/intermediate_json_files/*.json files
   Output_dir = {Decoder_radare2_to_PVS}/intermediate_dec_files/*.dec files

5> auto_decoder.py ( clock_get_syscalls.dec_batch ) ======> ( *.pvs files )
   Input_dir = /intermediate_dec_files
   Output_dir = /output_pvs_files


	Cheat sheet for intermediate / output file extensions:

	1> .r2 file  => radare2 manually handcrafted file with fn names
	2> .term file => intermediate file generated by terminal_fn_finder (recursive or non_recursive)
	3> .fn_term file => intermediate file generated by terminal_fn_finder withb the list of terminal fn for every syscall in the *.txt file
	4> .json file => intermediate file generated
	5> .dec file => intermediate file generated by the cfg_json_parser which is input for the auto_decoder.py
