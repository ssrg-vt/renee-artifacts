# Renee

## unicron-test-generation
Test generation for ARM v8 functions for verification using PVS.

## Project setup Instructions

1. Clone the repository

         https://github.com/ssrg-vt/renee-artifacts.git
  
2. Install Unicron Engine on your machine and setup using the python binding. Follow point 3 mentioned in the [Documentation](http://www.unicorn-engine.org/docs/)

3. Install the dependancies

        pip install requirements.txt

4. Change the directory to `TranslatorCodeFiles/{instruction_name}`. For example, `Renee/ReneeISAGenerator/ASL2PVS_code/InstructionParser/AutoTranslator/TranslatorCodeFiles`

5. Run the following shell script

        ./generate_random_tests.sh

## Radare2 installation
Renee Toolchain works for the radare2 version 3.1.3. We encountered bugs after installing the latest version (3.3.0) on new machines. Hence, it is a must to install the correct version from the archives.

Radare2 l documentation link https://www.radare.org/r/down.html

1. First download the tarball for the correct version using 

```
	$ wget https://github.com/radare/radare2/archive/3.1.3.tar.gz
	$ tar xzvf 3.1.3.tar.gz
	$ cd radare2-3.1.3/
	/radare2-3.1.3 $ ./configure --prefix=/usr
	/radare2-3.1.3 $ make -j8
	/radare2-3.1.3 $ sudo make install
```

Recommended Installation from Git:

```
        git clone https://github.com/radare/radare2
        cd radare2
        sys/install.sh   # just run this script to update r2 from git
```

Installation from tarball:

```
        $ wget https://github.com/radare/radare2/archive/3.3.0.tar.gz
        $ tar xzvf 3.3.0.tar.gz
        $ cd radare2-3.3.0/
        /radare2-3.3.0 $ ./configure --prefix=/usr
        /radare2-3.3.0 $ make -j8
        ~/radare2-3.3.0 $ sudo make install
```

Uninstall: To uninstall a r2 from a specific prefix run the following commands on the root directory of the radare2 source code:
```
        $ cd radare2
        /radare2 $ ./configure --prefix=/usr
        /radare2 $ sudo make uninstall
```
In case you want to remove all previous installations purge it.
```
        /radare2 $ sudo make purge
```

## Running the Radare2PVS toolchain: 
Radare2PVS toolchain is the first step in the Renee toolchain.It starts with the binary file for ARMv8.A set of scripts in the run.sh help to convert the binary. We use radare2 (a reverse engineering tool for binaries) for reverse engineering the binary.There are multiple steps in this process and files for each step need to be in a specific format. Each of these files are inputs to scripts.Below is a description of all the file formats at each stage of the Renne toolchain from binary input file to the corresponding pvs files.

1> Input .r2 radare file with function names [manually created]  ( clock_get_syscalls.r2 )
```
	dir = /input_r2_files
```

2> terminal_fn_finder_recursive.py ( clock_get_class_syscalls.r2 ) ====> ( clock_get_class_syscalls.fn_term* , clock_get_class_syscalls.term**  )
```
	Input_dir = /radare2_r2_input_files
        Output_dir = /intermediate_term_files
```
   ** This is an intermediate input/output file gives an overall aggregation of terminal functions , * This is an analysis file which gives terminql functions for every syscall in the input file

3> json_generator.py ( clock_get_class_syscalls.term ) ======> *.json files, clock_get_syscalls.batch
```   
   	Input_dir = /intermediate_term_files/clock_get_class_syscalls.term
        Output_dir = /intermediate_json_files/*.json files
```

4> cfg_json_parser.py ( clock_get_syscalls.batch ) =======> ( *.dec files, *_main.pvs files, clock_get_syscalls.dec_batch,  loop_analysis_info.txt ) *
```
        Input_dir = /intermediate_json_files/*.json files
        Output_dir = /intermediate_dec_files/*.dec files
```

5> basic_blocks_decompiler.py ( clock_get_syscalls.dec_batch ) ======> ( *.pvs files )
```
	Input_dir = /intermediate_dec_files
        Output_dir = /output_pvs_files
```

Cheat sheet:

```
	1> .r2 file  => radare2 manually handcrafted file with fn names
	2> .term file => intermediate file generated by `terminal_fn_finder` (recursive or non_recursive)
	3> .fn_term file => intermediate file generated by `terminal_fn_finder` withb the list of terminal fn for every syscall in the *.txt file
	4> .json file => intermediate file generated
	5> .dec file => intermediate file generated by the `cfg_json_parser` which is input for the `auto_decoder.py`
```
